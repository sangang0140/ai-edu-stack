name: AI Poll Auto Report

on:
  schedule:
    # ë§¤ì£¼ ì›”ìš”ì¼(1)ê³¼ ê¸ˆìš”ì¼(5) ì˜¤ì „ 11ì‹œ (KST = UTC+9 â†’ UTC 02ì‹œ)
    - cron: '0 2 * * 1,5'
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ë„ ê°€ëŠ¥í•˜ê²Œ

jobs:
  run-report:
    runs-on: ubuntu-latest

    steps:
      - name: âœ… ì €ì¥ì†Œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4

      - name: ğŸ Python í™˜ê²½ ì„¸íŒ…
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: ğŸŒ í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (OpenAI í‚¤)
        run: echo "OPENAI_API_KEY=${{ secrets.OPENAI_API_KEY }}" >> $GITHUB_ENV

      - name: ğŸ“¦ í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜ (ìë™ ê°ì§€)
        run: |
          pip install pandas requests beautifulsoup4 openai reportlab matplotlib

      - name: âš™ï¸ ì—¬ë¡  ë¶„ì„ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰
        run: |
          python templates/poll_analysis_agent/graph/nodes/poll_collector.py
          python templates/poll_analysis_agent/graph/nodes/trend_detector.py
          python templates/poll_analysis_agent/graph/nodes/insight_agent.py
          python templates/poll_analysis_agent/graph/nodes/report_generator.py
          python templates/poll_analysis_agent/graph/nodes/email_sender.py

      - name: ğŸ“¤ ë¦¬í¬íŠ¸ PDF ì—…ë¡œë“œ (ë°±ì—…ìš©)
        uses: actions/upload-artifact@v4
        with:
          name: poll-reports
          path: templates/poll_analysis_agent/data/report/*.pdf
